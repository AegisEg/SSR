{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"E:\\\\SSR\\\\Elements\\\\InputPhone.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\n// App\nimport React from \"react\"; //PHONE\n\nimport ReactPhoneInput from \"react-phone-input-2\";\nimport Button from \"../Elements/Button\";\nimport Input from \"../Elements/Input\";\nimport api from \"../config/api\";\nimport LoadingFixed from \"../Elements/LoadingFixed\";\nimport { toast } from \"react-toastify\";\n\nvar InputPhone = /*#__PURE__*/function (_React$Component) {\n  _inherits(InputPhone, _React$Component);\n\n  var _super = _createSuper(InputPhone);\n\n  function InputPhone() {\n    var _this;\n\n    _classCallCheck(this, InputPhone);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      isSend: false,\n      timer: false,\n      disabled: false,\n      code: false,\n      codeHash: false,\n      isUnique: false,\n      isFetching: false,\n      isUniqueCanDo: true\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"refresh\", function () {\n      _this.setState({\n        isSend: false,\n        timer: false,\n        disabled: false,\n        code: false,\n        codeHash: false,\n        isFetching: false,\n        isUniqueCanDo: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"sendSMS\", function () {\n      if (_this.props.value.length === 11 && _this.state.isUnique && !_this.state.isFetching) {\n        _this.setState({\n          isSend: true,\n          disabled: true,\n          timer: 60,\n          isFetching: true\n        }, function () {\n          fetch(\"\".concat(api.urlApi, \"/auth/smsSend\"), {\n            method: \"post\",\n            headers: {\n              Accept: \"application/json\",\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n              phone: _this.props.value\n            })\n          }).then(function (response) {\n            return response.json();\n          }).then(function (_ref) {\n            var error = _ref.error,\n                code = _ref.code,\n                codeReal = _ref.codeReal;\n\n            if (error) {\n              toast.error(\"Сообщение не доставлено. Свяжитесь с админстратором!\");\n\n              _this.props.setVerified(false);\n\n              _this.refresh();\n            } else {\n              alert(codeReal);\n\n              _this.setState({\n                isFetching: false,\n                codeHash: code\n              });\n\n              var Interval = setInterval( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                return _regeneratorRuntime.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        if (!!_this.state.timer) _this.setState({\n                          timer: _this.state.timer - 1\n                        });else {\n                          clearInterval(Interval);\n\n                          if (_this.props.isVerified !== \"success\") {\n                            _this.props.setVerified(false);\n\n                            _this.refresh();\n                          }\n                        }\n\n                      case 1:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee);\n              })), 1000);\n            }\n          });\n        });\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(InputPhone, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: [/*#__PURE__*/_jsxDEV(LoadingFixed, {\n          isLoading: this.state.isFetching\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col \",\n          style: {\n            paddingBottom: !this.state.isUnique && this.props.value.length === 11 && !this.state.isFetching && !this.state.isUniqueCanDo ? \"15px\" : \"0px\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"contents\",\n              position: \"relative\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(ReactPhoneInput, {\n              inputExtraProps: {\n                name: \"phone\"\n              },\n              disabled: this.state.disabled,\n              country: \"ru\",\n              disableDropdown: false,\n              style: this.props.style,\n              inputClass: \"col input-text \".concat(this.props.className, \" \").concat(this.props.error ? \"input-error\" : \"\"),\n              specialLabel: false,\n              placeholder: this.props.placeholder,\n              value: this.props.value,\n              on: true,\n              onChange: function onChange(val) {\n                if (!_this2.state.isSend) {\n                  if (val.length < _this2.props.value.length) _this2.setState({\n                    isUnique: false,\n                    isUniqueCanDo: true\n                  });\n\n                  if (val != _this2.props.value && val.length === 11) {\n                    _this2.setState({\n                      isFetching: true\n                    }, function () {\n                      fetch(\"\".concat(api.urlApi, \"/auth/uniquePhone\"), {\n                        method: \"post\",\n                        headers: {\n                          Accept: \"application/json\",\n                          \"Content-Type\": \"application/json\"\n                        },\n                        body: JSON.stringify({\n                          phone: val\n                        })\n                      }).then(function (response) {\n                        return response.json();\n                      }).then(function (_ref3) {\n                        var error = _ref3.error,\n                            unique = _ref3.unique;\n\n                        _this2.setState({\n                          isUnique: unique,\n                          isFetching: false,\n                          isUniqueCanDo: false\n                        });\n                      });\n                    });\n                  }\n\n                  _this2.props.onChange(val);\n                }\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 13\n            }, this), !this.state.isUnique && this.props.value.length === 11 && !this.state.isFetching && !this.state.isUniqueCanDo && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"input-error-label\",\n              children: \"\\u042D\\u0442\\u043E\\u0442 \\u043D\\u043E\\u043C\\u0435\\u0440 \\u0443\\u0436\\u0435 \\u0438\\u0441\\u043F\\u043E\\u043B\\u044C\\u0437\\u0443\\u0435\\u0442\\u0441\\u044F\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 157,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 11\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-12 col-sm-4 text-right mt-3 mt-sm-0 verified-field\",\n          style: {\n            alignSelf: \"flex-start\"\n          },\n          children: [this.props.isVerified === false && !this.state.isSend && /*#__PURE__*/_jsxDEV(Button, {\n            paddingVertical: \"8px\",\n            disable: this.props.value.length !== 11 && this.state.isUnique && !this.state.isFetching,\n            type: \"empty\",\n            onClick: this.sendSMS,\n            children: \"\\u041F\\u043E\\u043B\\u0443\\u0447\\u0438\\u0442\\u044C \\u043A\\u043E\\u0434\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 13\n          }, this), !(this.props.isVerified === \"success\" || this.props.isVerified === \"error\") && this.state.isSend && /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: \"contents\",\n              position: \"relative\"\n            },\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              type: \"text\",\n              className: \"input-error\",\n              value: this.state.code || \"\",\n              placeholder: \"\\u041A\\u043E\\u0434\",\n              onChange: function onChange(e) {\n                if (e.target.value.length <= 4 && !_this2.state.isFetching) _this2.setState({\n                  code: e.target.value\n                }, function () {\n                  if (_this2.state.code.length === 4) {\n                    fetch(\"\".concat(api.urlApi, \"/auth/compareCode\"), {\n                      method: \"post\",\n                      headers: {\n                        Accept: \"application/json\",\n                        \"Content-Type\": \"application/json\"\n                      },\n                      body: JSON.stringify({\n                        codeHash: _this2.state.codeHash,\n                        code: _this2.state.code\n                      })\n                    }).then(function (response) {\n                      return response.json();\n                    }).then(function (compare) {\n                      if (compare) _this2.props.setVerified(\"success\");else _this2.props.setVerified(\"error\");\n                    });\n                  }\n                });\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"input-error-label\",\n              children: [\"\\u041E\\u0441\\u0442\\u0430\\u043B\\u043E\\u0441\\u044C \", this.state.timer, \" \\u0441\\u0435\\u043A\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 15\n          }, this), this.props.isVerified === \"success\" && \"Подтвержден\", this.props.isVerified === \"error\" && \"\\u041F\\u043E\\u0432\\u0442\\u043E\\u0440\\u043D\\u043E \\u043E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043C\\u0441 \\u043C\\u043E\\u0436\\u043D\\u043E \\u0447\\u0435\\u0440\\u0435\\u0437 \".concat(this.state.timer)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return InputPhone;\n}(React.Component);\n\nexport default InputPhone;","map":{"version":3,"sources":["E:/SSR/Elements/InputPhone.js"],"names":["React","ReactPhoneInput","Button","Input","api","LoadingFixed","toast","InputPhone","isSend","timer","disabled","code","codeHash","isUnique","isFetching","isUniqueCanDo","setState","props","value","length","state","fetch","urlApi","method","headers","Accept","body","JSON","stringify","phone","then","response","json","error","codeReal","setVerified","refresh","alert","Interval","setInterval","clearInterval","isVerified","paddingBottom","display","position","name","style","className","placeholder","val","unique","onChange","alignSelf","sendSMS","e","target","compare","Component"],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA,OAAOA,KAAP,MAAkB,OAAlB,C,CACA;;AACA,OAAOC,eAAP,MAA4B,qBAA5B;AACA,OAAOC,MAAP,MAAmB,oBAAnB;AACA,OAAOC,KAAP,MAAkB,mBAAlB;AACA,OAAOC,GAAP,MAAgB,eAAhB;AACA,OAAOC,YAAP,MAAyB,0BAAzB;AACA,SAASC,KAAT,QAAsB,gBAAtB;;IACMC,U;;;;;;;;;;;;;;;;4DACI;AACNC,MAAAA,MAAM,EAAE,KADF;AAENC,MAAAA,KAAK,EAAE,KAFD;AAGNC,MAAAA,QAAQ,EAAE,KAHJ;AAINC,MAAAA,IAAI,EAAE,KAJA;AAKNC,MAAAA,QAAQ,EAAE,KALJ;AAMNC,MAAAA,QAAQ,EAAE,KANJ;AAONC,MAAAA,UAAU,EAAE,KAPN;AAQNC,MAAAA,aAAa,EAAE;AART,K;;8DAUE,YAAM;AACd,YAAKC,QAAL,CAAc;AACZR,QAAAA,MAAM,EAAE,KADI;AAEZC,QAAAA,KAAK,EAAE,KAFK;AAGZC,QAAAA,QAAQ,EAAE,KAHE;AAIZC,QAAAA,IAAI,EAAE,KAJM;AAKZC,QAAAA,QAAQ,EAAE,KALE;AAMZE,QAAAA,UAAU,EAAE,KANA;AAOZC,QAAAA,aAAa,EAAE;AAPH,OAAd;AASD,K;;8DACS,YAAM;AACd,UACE,MAAKE,KAAL,CAAWC,KAAX,CAAiBC,MAAjB,KAA4B,EAA5B,IACA,MAAKC,KAAL,CAAWP,QADX,IAEA,CAAC,MAAKO,KAAL,CAAWN,UAHd,EAIE;AACA,cAAKE,QAAL,CACE;AACER,UAAAA,MAAM,EAAE,IADV;AAEEE,UAAAA,QAAQ,EAAE,IAFZ;AAGED,UAAAA,KAAK,EAAE,EAHT;AAIEK,UAAAA,UAAU,EAAE;AAJd,SADF,EAOE,YAAM;AACJO,UAAAA,KAAK,WAAIjB,GAAG,CAACkB,MAAR,oBAA+B;AAClCC,YAAAA,MAAM,EAAE,MAD0B;AAElCC,YAAAA,OAAO,EAAE;AACPC,cAAAA,MAAM,EAAE,kBADD;AAEP,8BAAgB;AAFT,aAFyB;AAMlCC,YAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBC,cAAAA,KAAK,EAAE,MAAKZ,KAAL,CAAWC;AADC,aAAf;AAN4B,WAA/B,CAAL,CAUGY,IAVH,CAUQ,UAACC,QAAD;AAAA,mBAAcA,QAAQ,CAACC,IAAT,EAAd;AAAA,WAVR,EAWGF,IAXH,CAWQ,gBAA+B;AAAA,gBAA5BG,KAA4B,QAA5BA,KAA4B;AAAA,gBAArBtB,IAAqB,QAArBA,IAAqB;AAAA,gBAAfuB,QAAe,QAAfA,QAAe;;AACnC,gBAAID,KAAJ,EAAW;AACT3B,cAAAA,KAAK,CAAC2B,KAAN,CACE,sDADF;;AAGA,oBAAKhB,KAAL,CAAWkB,WAAX,CAAuB,KAAvB;;AACA,oBAAKC,OAAL;AACD,aAND,MAMO;AACLC,cAAAA,KAAK,CAACH,QAAD,CAAL;;AACA,oBAAKlB,QAAL,CAAc;AAAEF,gBAAAA,UAAU,EAAE,KAAd;AAAqBF,gBAAAA,QAAQ,EAAED;AAA/B,eAAd;;AACA,kBAAI2B,QAAQ,GAAGC,WAAW,wEAAC;AAAA;AAAA;AAAA;AAAA;AACzB,4BAAI,CAAC,CAAC,MAAKnB,KAAL,CAAWX,KAAjB,EACE,MAAKO,QAAL,CAAc;AACZP,0BAAAA,KAAK,EAAE,MAAKW,KAAL,CAAWX,KAAX,GAAmB;AADd,yBAAd,EADF,KAIK;AACH+B,0BAAAA,aAAa,CAACF,QAAD,CAAb;;AACA,8BAAI,MAAKrB,KAAL,CAAWwB,UAAX,KAA0B,SAA9B,EAAyC;AACvC,kCAAKxB,KAAL,CAAWkB,WAAX,CAAuB,KAAvB;;AACA,kCAAKC,OAAL;AACD;AACF;;AAXwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAD,IAYvB,IAZuB,CAA1B;AAaD;AACF,WAnCH;AAoCD,SA5CH;AA8CD;AACF,K;;;;;;;6BACQ;AAAA;;AACP,0BACE;AAAK,QAAA,SAAS,EAAC,KAAf;AAAA,gCACE,QAAC,YAAD;AAAc,UAAA,SAAS,EAAE,KAAKhB,KAAL,CAAWN;AAApC;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE;AACE,UAAA,SAAS,EAAC,MADZ;AAEE,UAAA,KAAK,EAAE;AACL4B,YAAAA,aAAa,EACX,CAAC,KAAKtB,KAAL,CAAWP,QAAZ,IACA,KAAKI,KAAL,CAAWC,KAAX,CAAiBC,MAAjB,KAA4B,EAD5B,IAEA,CAAC,KAAKC,KAAL,CAAWN,UAFZ,IAGA,CAAC,KAAKM,KAAL,CAAWL,aAHZ,GAII,MAJJ,GAKI;AAPD,WAFT;AAAA,iCAYE;AACE,YAAA,KAAK,EAAE;AACL4B,cAAAA,OAAO,EAAE,UADJ;AAELC,cAAAA,QAAQ,EAAE;AAFL,aADT;AAAA,oCAME,QAAC,eAAD;AACE,cAAA,eAAe,EAAE;AACfC,gBAAAA,IAAI,EAAE;AADS,eADnB;AAIE,cAAA,QAAQ,EAAE,KAAKzB,KAAL,CAAWV,QAJvB;AAKE,cAAA,OAAO,EAAE,IALX;AAME,cAAA,eAAe,EAAE,KANnB;AAOE,cAAA,KAAK,EAAE,KAAKO,KAAL,CAAW6B,KAPpB;AAQE,cAAA,UAAU,2BAAoB,KAAK7B,KAAL,CAAW8B,SAA/B,cACR,KAAK9B,KAAL,CAAWgB,KAAX,GAAmB,aAAnB,GAAmC,EAD3B,CARZ;AAWE,cAAA,YAAY,EAAE,KAXhB;AAYE,cAAA,WAAW,EAAE,KAAKhB,KAAL,CAAW+B,WAZ1B;AAaE,cAAA,KAAK,EAAE,KAAK/B,KAAL,CAAWC,KAbpB;AAcE,cAAA,EAAE,MAdJ;AAeE,cAAA,QAAQ,EAAE,kBAAC+B,GAAD,EAAS;AACjB,oBAAI,CAAC,MAAI,CAAC7B,KAAL,CAAWZ,MAAhB,EAAwB;AACtB,sBAAIyC,GAAG,CAAC9B,MAAJ,GAAa,MAAI,CAACF,KAAL,CAAWC,KAAX,CAAiBC,MAAlC,EACE,MAAI,CAACH,QAAL,CAAc;AAAEH,oBAAAA,QAAQ,EAAE,KAAZ;AAAmBE,oBAAAA,aAAa,EAAE;AAAlC,mBAAd;;AACF,sBAAIkC,GAAG,IAAI,MAAI,CAAChC,KAAL,CAAWC,KAAlB,IAA2B+B,GAAG,CAAC9B,MAAJ,KAAe,EAA9C,EAAkD;AAChD,oBAAA,MAAI,CAACH,QAAL,CAAc;AAAEF,sBAAAA,UAAU,EAAE;AAAd,qBAAd,EAAoC,YAAM;AACxCO,sBAAAA,KAAK,WAAIjB,GAAG,CAACkB,MAAR,wBAAmC;AACtCC,wBAAAA,MAAM,EAAE,MAD8B;AAEtCC,wBAAAA,OAAO,EAAE;AACPC,0BAAAA,MAAM,EAAE,kBADD;AAEP,0CAAgB;AAFT,yBAF6B;AAMtCC,wBAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBC,0BAAAA,KAAK,EAAEoB;AADY,yBAAf;AANgC,uBAAnC,CAAL,CAUGnB,IAVH,CAUQ,UAACC,QAAD;AAAA,+BAAcA,QAAQ,CAACC,IAAT,EAAd;AAAA,uBAVR,EAWGF,IAXH,CAWQ,iBAAuB;AAAA,4BAApBG,KAAoB,SAApBA,KAAoB;AAAA,4BAAbiB,MAAa,SAAbA,MAAa;;AAC3B,wBAAA,MAAI,CAAClC,QAAL,CAAc;AACZH,0BAAAA,QAAQ,EAAEqC,MADE;AAEZpC,0BAAAA,UAAU,EAAE,KAFA;AAGZC,0BAAAA,aAAa,EAAE;AAHH,yBAAd;AAKD,uBAjBH;AAkBD,qBAnBD;AAoBD;;AACD,kBAAA,MAAI,CAACE,KAAL,CAAWkC,QAAX,CAAoBF,GAApB;AACD;AACF;AA3CH;AAAA;AAAA;AAAA;AAAA,oBANF,EAmDG,CAAC,KAAK7B,KAAL,CAAWP,QAAZ,IACC,KAAKI,KAAL,CAAWC,KAAX,CAAiBC,MAAjB,KAA4B,EAD7B,IAEC,CAAC,KAAKC,KAAL,CAAWN,UAFb,IAGC,CAAC,KAAKM,KAAL,CAAWL,aAHb,iBAIG;AAAM,cAAA,SAAS,EAAC,mBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAvDN;AAAA;AAAA;AAAA;AAAA;AAAA;AAZF;AAAA;AAAA;AAAA;AAAA,gBAFF,eA4EE;AACE,UAAA,SAAS,EAAC,wDADZ;AAEE,UAAA,KAAK,EAAE;AACLqC,YAAAA,SAAS,EAAE;AADN,WAFT;AAAA,qBAMG,KAAKnC,KAAL,CAAWwB,UAAX,KAA0B,KAA1B,IAAmC,CAAC,KAAKrB,KAAL,CAAWZ,MAA/C,iBACC,QAAC,MAAD;AACE,YAAA,eAAe,EAAE,KADnB;AAEE,YAAA,OAAO,EACL,KAAKS,KAAL,CAAWC,KAAX,CAAiBC,MAAjB,KAA4B,EAA5B,IACA,KAAKC,KAAL,CAAWP,QADX,IAEA,CAAC,KAAKO,KAAL,CAAWN,UALhB;AAOE,YAAA,IAAI,EAAC,OAPP;AAQE,YAAA,OAAO,EAAE,KAAKuC,OARhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAPJ,EAoBG,EACC,KAAKpC,KAAL,CAAWwB,UAAX,KAA0B,SAA1B,IACA,KAAKxB,KAAL,CAAWwB,UAAX,KAA0B,OAF3B,KAIC,KAAKrB,KAAL,CAAWZ,MAJZ,iBAKG;AACE,YAAA,KAAK,EAAE;AACLmC,cAAAA,OAAO,EAAE,UADJ;AAELC,cAAAA,QAAQ,EAAE;AAFL,aADT;AAAA,oCAME,QAAC,KAAD;AACE,cAAA,IAAI,EAAC,MADP;AAEE,cAAA,SAAS,EAAC,aAFZ;AAGE,cAAA,KAAK,EAAE,KAAKxB,KAAL,CAAWT,IAAX,IAAmB,EAH5B;AAIE,cAAA,WAAW,EAAC,oBAJd;AAKE,cAAA,QAAQ,EAAE,kBAAC2C,CAAD,EAAO;AACf,oBAAIA,CAAC,CAACC,MAAF,CAASrC,KAAT,CAAeC,MAAf,IAAyB,CAAzB,IAA8B,CAAC,MAAI,CAACC,KAAL,CAAWN,UAA9C,EACE,MAAI,CAACE,QAAL,CACE;AACEL,kBAAAA,IAAI,EAAE2C,CAAC,CAACC,MAAF,CAASrC;AADjB,iBADF,EAIE,YAAM;AACJ,sBAAI,MAAI,CAACE,KAAL,CAAWT,IAAX,CAAgBQ,MAAhB,KAA2B,CAA/B,EAAkC;AAChCE,oBAAAA,KAAK,WAAIjB,GAAG,CAACkB,MAAR,wBAAmC;AACtCC,sBAAAA,MAAM,EAAE,MAD8B;AAEtCC,sBAAAA,OAAO,EAAE;AACPC,wBAAAA,MAAM,EAAE,kBADD;AAEP,wCAAgB;AAFT,uBAF6B;AAMtCC,sBAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBhB,wBAAAA,QAAQ,EAAE,MAAI,CAACQ,KAAL,CAAWR,QADF;AAEnBD,wBAAAA,IAAI,EAAE,MAAI,CAACS,KAAL,CAAWT;AAFE,uBAAf;AANgC,qBAAnC,CAAL,CAWGmB,IAXH,CAWQ,UAACC,QAAD;AAAA,6BAAcA,QAAQ,CAACC,IAAT,EAAd;AAAA,qBAXR,EAYGF,IAZH,CAYQ,UAAC0B,OAAD,EAAa;AACjB,0BAAIA,OAAJ,EAAa,MAAI,CAACvC,KAAL,CAAWkB,WAAX,CAAuB,SAAvB,EAAb,KACK,MAAI,CAAClB,KAAL,CAAWkB,WAAX,CAAuB,OAAvB;AACN,qBAfH;AAgBD;AACF,iBAvBH;AAyBH;AAhCH;AAAA;AAAA;AAAA;AAAA,oBANF,eAwCE;AAAM,cAAA,SAAS,EAAC,mBAAhB;AAAA,8EACY,KAAKf,KAAL,CAAWX,KADvB;AAAA;AAAA;AAAA;AAAA;AAAA,oBAxCF;AAAA;AAAA;AAAA;AAAA;AAAA,kBAzBN,EAsEG,KAAKQ,KAAL,CAAWwB,UAAX,KAA0B,SAA1B,IAAuC,aAtE1C,EAuEG,KAAKxB,KAAL,CAAWwB,UAAX,KAA0B,OAA1B,uMACuC,KAAKrB,KAAL,CAAWX,KADlD,CAvEH;AAAA;AAAA;AAAA;AAAA;AAAA,gBA5EF;AAAA;AAAA;AAAA;AAAA;AAAA,cADF;AAyJD;;;;EAtOsBT,KAAK,CAACyD,S;;AAyO/B,eAAelD,UAAf","sourcesContent":["// App\r\nimport React from \"react\";\r\n//PHONE\r\nimport ReactPhoneInput from \"react-phone-input-2\";\r\nimport Button from \"../Elements/Button\";\r\nimport Input from \"../Elements/Input\";\r\nimport api from \"../config/api\";\r\nimport LoadingFixed from \"../Elements/LoadingFixed\";\r\nimport { toast } from \"react-toastify\";\r\nclass InputPhone extends React.Component {\r\n  state = {\r\n    isSend: false,\r\n    timer: false,\r\n    disabled: false,\r\n    code: false,\r\n    codeHash: false,\r\n    isUnique: false,\r\n    isFetching: false,\r\n    isUniqueCanDo: true,\r\n  };\r\n  refresh = () => {\r\n    this.setState({\r\n      isSend: false,\r\n      timer: false,\r\n      disabled: false,\r\n      code: false,\r\n      codeHash: false,\r\n      isFetching: false,\r\n      isUniqueCanDo: true,\r\n    });\r\n  };\r\n  sendSMS = () => {\r\n    if (\r\n      this.props.value.length === 11 &&\r\n      this.state.isUnique &&\r\n      !this.state.isFetching\r\n    ) {\r\n      this.setState(\r\n        {\r\n          isSend: true,\r\n          disabled: true,\r\n          timer: 60,\r\n          isFetching: true,\r\n        },\r\n        () => {\r\n          fetch(`${api.urlApi}/auth/smsSend`, {\r\n            method: \"post\",\r\n            headers: {\r\n              Accept: \"application/json\",\r\n              \"Content-Type\": \"application/json\",\r\n            },\r\n            body: JSON.stringify({\r\n              phone: this.props.value,\r\n            }),\r\n          })\r\n            .then((response) => response.json())\r\n            .then(({ error, code, codeReal }) => {\r\n              if (error) {\r\n                toast.error(\r\n                  \"Сообщение не доставлено. Свяжитесь с админстратором!\"\r\n                );\r\n                this.props.setVerified(false);\r\n                this.refresh();\r\n              } else {\r\n                alert(codeReal);\r\n                this.setState({ isFetching: false, codeHash: code });\r\n                let Interval = setInterval(async () => {\r\n                  if (!!this.state.timer)\r\n                    this.setState({\r\n                      timer: this.state.timer - 1,\r\n                    });\r\n                  else {\r\n                    clearInterval(Interval);\r\n                    if (this.props.isVerified !== \"success\") {\r\n                      this.props.setVerified(false);\r\n                      this.refresh();\r\n                    }\r\n                  }\r\n                }, 1000);\r\n              }\r\n            });\r\n        }\r\n      );\r\n    }\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"row\">\r\n        <LoadingFixed isLoading={this.state.isFetching} />\r\n        <div\r\n          className=\"col \"\r\n          style={{\r\n            paddingBottom:\r\n              !this.state.isUnique &&\r\n              this.props.value.length === 11 &&\r\n              !this.state.isFetching &&\r\n              !this.state.isUniqueCanDo\r\n                ? \"15px\"\r\n                : \"0px\",\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              display: \"contents\",\r\n              position: \"relative\",\r\n            }}\r\n          >\r\n            <ReactPhoneInput\r\n              inputExtraProps={{\r\n                name: \"phone\",\r\n              }}\r\n              disabled={this.state.disabled}\r\n              country={\"ru\"}\r\n              disableDropdown={false}\r\n              style={this.props.style}\r\n              inputClass={`col input-text ${this.props.className} ${\r\n                this.props.error ? \"input-error\" : \"\"\r\n              }`}\r\n              specialLabel={false}\r\n              placeholder={this.props.placeholder}\r\n              value={this.props.value}\r\n              on\r\n              onChange={(val) => {\r\n                if (!this.state.isSend) {\r\n                  if (val.length < this.props.value.length)\r\n                    this.setState({ isUnique: false, isUniqueCanDo: true });\r\n                  if (val != this.props.value && val.length === 11) {\r\n                    this.setState({ isFetching: true }, () => {\r\n                      fetch(`${api.urlApi}/auth/uniquePhone`, {\r\n                        method: \"post\",\r\n                        headers: {\r\n                          Accept: \"application/json\",\r\n                          \"Content-Type\": \"application/json\",\r\n                        },\r\n                        body: JSON.stringify({\r\n                          phone: val,\r\n                        }),\r\n                      })\r\n                        .then((response) => response.json())\r\n                        .then(({ error, unique }) => {\r\n                          this.setState({\r\n                            isUnique: unique,\r\n                            isFetching: false,\r\n                            isUniqueCanDo: false,\r\n                          });\r\n                        });\r\n                    });\r\n                  }\r\n                  this.props.onChange(val);\r\n                }\r\n              }}\r\n            />\r\n            {!this.state.isUnique &&\r\n              this.props.value.length === 11 &&\r\n              !this.state.isFetching &&\r\n              !this.state.isUniqueCanDo && (\r\n                <span className=\"input-error-label\">\r\n                  Этот номер уже используется\r\n                </span>\r\n              )}\r\n          </div>\r\n        </div>\r\n\r\n        <div\r\n          className=\"col-12 col-sm-4 text-right mt-3 mt-sm-0 verified-field\"\r\n          style={{\r\n            alignSelf: \"flex-start\",\r\n          }}\r\n        >\r\n          {this.props.isVerified === false && !this.state.isSend && (\r\n            <Button\r\n              paddingVertical={\"8px\"}\r\n              disable={\r\n                this.props.value.length !== 11 &&\r\n                this.state.isUnique &&\r\n                !this.state.isFetching\r\n              }\r\n              type=\"empty\"\r\n              onClick={this.sendSMS}\r\n            >\r\n              Получить код\r\n            </Button>\r\n          )}\r\n          {!(\r\n            this.props.isVerified === \"success\" ||\r\n            this.props.isVerified === \"error\"\r\n          ) &&\r\n            this.state.isSend && (\r\n              <div\r\n                style={{\r\n                  display: \"contents\",\r\n                  position: \"relative\",\r\n                }}\r\n              >\r\n                <Input\r\n                  type=\"text\"\r\n                  className=\"input-error\"\r\n                  value={this.state.code || \"\"}\r\n                  placeholder=\"Код\"\r\n                  onChange={(e) => {\r\n                    if (e.target.value.length <= 4 && !this.state.isFetching)\r\n                      this.setState(\r\n                        {\r\n                          code: e.target.value,\r\n                        },\r\n                        () => {\r\n                          if (this.state.code.length === 4) {\r\n                            fetch(`${api.urlApi}/auth/compareCode`, {\r\n                              method: \"post\",\r\n                              headers: {\r\n                                Accept: \"application/json\",\r\n                                \"Content-Type\": \"application/json\",\r\n                              },\r\n                              body: JSON.stringify({\r\n                                codeHash: this.state.codeHash,\r\n                                code: this.state.code,\r\n                              }),\r\n                            })\r\n                              .then((response) => response.json())\r\n                              .then((compare) => {\r\n                                if (compare) this.props.setVerified(\"success\");\r\n                                else this.props.setVerified(\"error\");\r\n                              });\r\n                          }\r\n                        }\r\n                      );\r\n                  }}\r\n                ></Input>\r\n                <span className=\"input-error-label\">\r\n                  Осталось {this.state.timer} сек\r\n                </span>\r\n              </div>\r\n            )}\r\n          {this.props.isVerified === \"success\" && \"Подтвержден\"}\r\n          {this.props.isVerified === \"error\" &&\r\n            `Повторно отправить смс можно через ${this.state.timer}`}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default InputPhone;\r\n"]},"metadata":{},"sourceType":"module"}